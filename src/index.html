<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASD Dashboard</title>
    <link rel="stylesheet" href="ui/styles.css">
</head>
<body>
    <div id="controls">
        <label>
            <input type="checkbox" id="sw-toggle">ðŸ“¡
        </label>
        <button id="localStorage-edit-button">ðŸ’¾</button>
        <select id="service-selector">
            <option value="">Select a Service</option>
            <!-- Options will be dynamically populated -->
        </select>
        <input type="text" id="widget-url" placeholder="Or enter URL manually">
        <button id="add-widget-button">Add Widget</button>
        <button id="toggle-widget-buttons">Widget menu</button>
        <button id="reset-button">Reset</button>
    </div>
    <div id="control-panel">
        <select id="board-selector"></select>
        <button id="create-board-button">Create Board</button>
        <button id="rename-board-button">Rename Board</button>
        <button id="delete-board-button">Delete Board</button>
        <select id="view-selector"></select>
        <button id="create-view-button">Create View</button>
        <button id="rename-view-button">Rename View</button>
        <button id="delete-view-button">Delete View</button>
        <button id="reset-view-button">Reset View</button>
    </div>
    <main>
        <div class="board">
            <!-- A board will be dynamically loaded here -->
            <div class="board-view">
                <!-- A view will be dynamically loaded here -->
                <div id="widget-container">
                    <!-- Widgets will be dynamically loaded here -->
                </div>
            </div>
        </div>
    </main>
    <script>
        const swToggle = document.getElementById('sw-toggle');
        const swEnabled = localStorage.getItem('swEnabled') === 'true';
        swToggle.checked = swEnabled;

        if ('serviceWorker' in navigator) {
            function registerServiceWorker() {
                navigator.serviceWorker.register('/serviceWorker.js', { scope: '/' })
                    .then(function (registration) {
                        console.log('Service Worker registered with scope:', registration.scope);
                    })
                    .catch(function (error) {
                        console.error('Service Worker registration failed:', error);
                    });
            }

            function unregisterServiceWorker() {
                navigator.serviceWorker.getRegistrations()
                    .then(function (registrations) {
                        for (let registration of registrations) {
                            registration.unregister()
                                .then(function () {
                                    console.log('Service Worker unregistered');
                                })
                                .catch(function (error) {
                                    console.error('Service Worker unregistration failed:', error);
                                });
                        }
                    });
                caches.keys().then(function (cacheNames) {
                    return Promise.all(
                        cacheNames.map(function (cacheName) {
                            return caches.delete(cacheName);
                        })
                    ).then(function () {
                        console.log('All caches cleared');
                    });
                });
            }

            if (swEnabled) {
                registerServiceWorker();
            } else {
                unregisterServiceWorker();
            }

            swToggle.addEventListener('change', function () {
                const isEnabled = swToggle.checked;
                localStorage.setItem('swEnabled', isEnabled);

                if (isEnabled) {
                    registerServiceWorker();
                } else {
                    unregisterServiceWorker();
                }
            });
        }
    </script>
    <script type="module" src="main.js"></script>
</body>
</html>